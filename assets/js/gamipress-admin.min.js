(function($){$("#_gamipress_earned_by").change(function(){var gamipress_sequential=$('#_gamipress_sequential').parent().parent();var gamipress_points_required=$('#_gamipress_points_required').parent().parent();var gamipress_points_type_required=$('#_gamipress_points_type_required').parent().parent();gamipress_sequential.hide();gamipress_points_required.hide();gamipress_points_type_required.hide();if('triggers'==$(this).val()){gamipress_sequential.show()}else if('points'==$(this).val()){gamipress_points_required.show();gamipress_points_type_required.show()}}).change();$('.gamipress-form').on('keyup','input#post_name',function(){var label=$('#post_type').val()==='achievement-type'?'Achievement Type':'Points type';var field=$(this);var slug=$(this).val();var preview=$(this).next('.cmb2-metabox-description').find('.gamipress-post-name');if(preview.length){preview.text(slug)}
$('#slug-warning').remove();if(slug.length>20){field.css({'background':'#faa','color':'#a00','border-color':'#a55'});field.parent().append('<span id="slug-warning" class="cmb2-metabox-description" style="color: #a00;">'+label+'\'s slug supports a maximum of 20 characters.</span>')}else{field.css({'background':'','color':'','border-color':''})}});$('.gamipress-form input#post_name').trigger('keyup');if($('.gamipress_settings').length){$('#achievement-earned-email-send, #step-completed-email-send, #points-award-completed-email-send').click(function(e){e.preventDefault();var $this=$(this);$this.prop('disabled',!0);$this.parent().append('<span class="spinner is-active" style="float:none;"></span>');$.ajax({url:$this.attr('href'),method:'get',success:function(response){$this.prop('disabled',!1);$this.parent().find('.spinner').remove();$this.parent().append('<span class="send-response" '+(!response.success?'style="color: #a00;':'')+'">'+response.data+'</span>');setTimeout(function(){$this.parent().find('.send-response').remove()},3000)},error:function(response){$this.prop('disabled',!1);$this.parent().find('.spinner').remove();$this.parent().append('<span class="send-response" style="color: #a00;">'+response.data+'</span>');setTimeout(function(){$this.parent().find('.send-response').remove()},3000)}})});$('#disable_achievement_earned_email').change(function(){var target=$('.cmb2-id-achievement-earned-email-subject, .cmb2-id-achievement-earned-email-content');if($(this).prop('checked')){target.slideUp()}else{target.slideDown()}});if($('#disable_achievement_earned_email').prop('checked')){$('.cmb2-id-achievement-earned-email-subject, .cmb2-id-achievement-earned-email-content').hide()}
$('#disable_step_completed_email').change(function(){var target=$('.cmb2-id-step-completed-email-subject, .cmb2-id-step-completed-email-content');if($(this).prop('checked')){target.slideUp()}else{target.slideDown()}});if($('#disable_step_completed_email').prop('checked')){$('.cmb2-id-step-completed-email-subject, .cmb2-id-step-completed-email-content').hide()}
$('#disable_points_award_completed_email').change(function(){var target=$('.cmb2-id-points-award-completed-email-subject, .cmb2-id-points-award-completed-email-content');if($(this).prop('checked')){target.slideUp()}else{target.slideDown()}});if($('#disable_points_award_completed_email').prop('checked')){$('.cmb2-id-points-award-completed-email-subject, .cmb2-id-points-award-completed-email-content').hide()}
$('#automatic_updates').change(function(){var target=$('.cmb2-id-automatic-updates-plugins');if(target.length){if($(this).prop('checked')){target.slideDown()}else{target.slideUp()}}});if(!$('#automatic_updates').prop('checked')){$('.cmb2-id-automatic-updates-plugins').hide()}}
if($('#gamipress-upgrade-notice').find('.gamipress-upgrade-progress[data-running-upgrade]').length){gamipress_start_upgrade($('#gamipress-upgrade-notice').find('.gamipress-upgrade-progress[data-running-upgrade]').data('running-upgrade'))}})(jQuery);var gamipress_current_upgrade_info;var gamipress_current_upgrade_progress;function gamipress_start_upgrade(version){var $=$||jQuery;version=version.replace('.','').replace('.','').replace('.','');$('#gamipress-upgrade-notice').html('<p>Upgrading GamiPress database...</p><div class="gamipress-upgrade-progress"><div class="gamipress-upgrade-progress-bar" style="width: 0%;"></div></div>');$.ajax({url:ajaxurl,data:{action:'gamipress_'+version+'_upgrade_info'},success:function(response){if(response.data.upgraded!==undefined&&response.data.upgraded){$('#gamipress-upgrade-notice').html('<p>Upgrade has been already completed.</p><div class="gamipress-upgrade-progress"><div class="gamipress-upgrade-progress-bar" style="width: 100%;"></div></div>');return}
gamipress_current_upgrade_info=response.data.total;gamipress_current_upgrade_progress=0;gamipress_run_upgrade(version)},error:function(response){gamipress_stop_upgrade(version);$('#gamipress-upgrade-notice').html('<p class="error">Upgrading process failed.</p>')}})}
function gamipress_run_upgrade(version){var $=$||jQuery;version=version.replace('.','').replace('.','').replace('.','');$.ajax({url:ajaxurl,data:{action:'gamipress_process_'+version+'_upgrade',current:gamipress_current_upgrade_progress,},success:function(response){if(response.data.upgraded!==undefined&&response.data.upgraded){$('#gamipress-upgrade-notice').html('<p>Upgrading process finished successfully.</p><div class="gamipress-upgrade-progress"><div class="gamipress-upgrade-progress-bar" style="width: 100%;"></div></div>');return}
gamipress_current_upgrade_progress=response.data.current;if(gamipress_current_upgrade_progress>=gamipress_current_upgrade_info){$('#gamipress-upgrade-notice').html('<p>Upgrading process finished successfully.</p><div class="gamipress-upgrade-progress"><div class="gamipress-upgrade-progress-bar" style="width: 100%;"></div></div>');return}
$('#gamipress-upgrade-notice .gamipress-upgrade-progress .gamipress-upgrade-progress-bar').attr('style','width: '+((gamipress_current_upgrade_progress/gamipress_current_upgrade_info)*100)+'%')
gamipress_run_upgrade(version)},error:function(response){gamipress_stop_upgrade(version);$('#gamipress-upgrade-notice').html('<p class="error">Upgrading process failed.</p>')}})}
function gamipress_stop_upgrade(version){var $=$||jQuery;version=version.replace('.','').replace('.','').replace('.','');$.ajax({url:ajaxurl,data:{action:'gamipress_stop_process_'+version+'_upgrade'}})}