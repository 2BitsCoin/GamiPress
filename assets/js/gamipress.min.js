(function($){var $body=$('body');function gamipress_ajax_achievement_list(achievement_list){achievement_list.find('.gamipress-spinner').show();$.ajax({url:gamipress.ajaxurl,data:{action:'gamipress_get_achievements',type:achievement_list.find('input[type="hidden"][name="type"]').val(),limit:achievement_list.find('input[type="hidden"][name="limit"]').val(),user_id:achievement_list.find('input[type="hidden"][name="user_id"]').val(),wpms:achievement_list.find('input[type="hidden"][name="wpms"]').val(),offset:achievement_list.find('#gamipress_achievements_offset').val(),count:achievement_list.find('#gamipress_achievements_count').val(),filter:((achievement_list.find('#achievements_list_filter').length)?achievement_list.find('#achievements_list_filter').val():''),search:achievement_list.find('#achievements_list_search').val(),orderby:achievement_list.find('input[type="hidden"][name="orderby"]').val(),order:achievement_list.find('input[type="hidden"][name="order"]').val(),include:achievement_list.find('input[type="hidden"][name="include"]').val(),exclude:achievement_list.find('input[type="hidden"][name="exclude"]').val(),},dataType:'json',success:function(response){achievement_list.find('.gamipress-spinner').hide();if(response.data.message===null){}else{achievement_list.find('#gamipress-achievements-container').append(response.data.message);achievement_list.find('#gamipress_achievements_offset').val(response.data.offset);achievement_list.find('#gamipress_achievements_count').val(response.data.achievement_count);if(achievement_list.find('#achievements_list_load_more').length){if(response.data.query_count<=response.data.offset){achievement_list.find('#achievements_list_load_more').hide()}else{achievement_list.find('#achievements_list_load_more').show()}}}}})}
function gamipress_ajax_achievement_list_reset(achievement_list){achievement_list.find('#gamipress_achievements_offset').val(0);achievement_list.find('#gamipress_achievements_count').val(0);achievement_list.find('#gamipress-achievements-container').html('');achievement_list.find('#achievements_list_load_more').hide();gamipress_ajax_achievement_list(achievement_list)}
$body.on('change','#achievements_list_filter',function(){gamipress_ajax_achievement_list_reset($(this).closest('.gamipress-achievements-list'))});$body.on('submit','#achievements_list_search_go_form',function(event){event.preventDefault();gamipress_ajax_achievement_list_reset($(this).closest('.gamipress-achievements-list'));$(this).prop('disabled',!0)});$body.on('focus','#achievements_list_search',function(e){$(this).closest('.gamipress-achievements-list').find('#achievements_list_search_go').prop('disabled',!1)});$body.on('click','#achievements_list_load_more',function(){$(this).closest('.gamipress-achievements-list').find('.gamipress-spinner').show();gamipress_ajax_achievement_list($(this).closest('.gamipress-achievements-list'))});$('.gamipress-achievements-list').each(function(){gamipress_ajax_achievement_list($(this))});$body.on('click','.gamipress-open-close-switch a',function(event){event.preventDefault();var link=$(this);if('close'===link.data('action')){link.parent().siblings('.gamipress-extras-window').slideUp(300);link.data('action','open').prop('class','show-hide-open').text(link.data('open-text'))}else{link.parent().siblings('.gamipress-extras-window').slideDown(300);link.data('action','close').prop('class','show-hide-close').text(link.data('close-text'))}});$body.on('click','.gamipress-achievement-unlock-with-points-button',function(e){var button=$(this);var submit_wrap=button.parent();var spinner=submit_wrap.find('.gamipress-spinner');var achievement_id=button.data('id');button.prop('disabled',!0);if(submit_wrap.find('.gamipress-achievement-unlock-with-points-response').length){submit_wrap.find('.gamipress-achievement-unlock-with-points-response').slideUp()}
spinner.show();$.ajax({url:gamipress.ajaxurl,method:'POST',dataType:'json',data:{action:'gamipress_unlock_achievement_with_points',achievement_id:achievement_id},success:function(response){if(submit_wrap.find('.gamipress-achievement-unlock-with-points-response').length===0){submit_wrap.prepend('<div class="gamipress-achievement-unlock-with-points-response gamipress-notice" style="display: none;"></div>')}
var response_wrap=submit_wrap.find('.gamipress-achievement-unlock-with-points-response');response_wrap.addClass('gamipress-notice-'+(response.success===!0?'success':'error'));response_wrap.html(response.data);response_wrap.slideDown();spinner.hide();if(response.success===!0){button.slideUp();button.closest('.single-achievement').addClass('user-has-earned');button.closest('.user-has-not-earned[class*="post"]').removeClass('user-has-not-earned').addClass('user-has-earned');button.closest('.gamipress-achievement.user-has-not-earned').removeClass('user-has-not-earned').addClass('user-has-earned')}else{button.prop('disabled',!1)}}})});$body.on('click','.gamipress-rank-unlock-with-points-button',function(e){var button=$(this);var submit_wrap=button.parent();var spinner=submit_wrap.find('.gamipress-spinner');var rank_id=button.data('id');button.prop('disabled',!0);if(submit_wrap.find('.gamipress-rank-unlock-with-points-response').length){submit_wrap.find('.gamipress-rank-unlock-with-points-response').slideUp()}
spinner.show();$.ajax({url:gamipress.ajaxurl,method:'POST',dataType:'json',data:{action:'gamipress_unlock_rank_with_points',rank_id:rank_id},success:function(response){if(submit_wrap.find('.gamipress-rank-unlock-with-points-response').length===0){submit_wrap.prepend('<div class="gamipress-rank-unlock-with-points-response gamipress-notice" style="display: none;"></div>')}
var response_wrap=submit_wrap.find('.gamipress-rank-unlock-with-points-response');response_wrap.addClass('gamipress-notice-'+(response.success===!0?'success':'error'));response_wrap.html(response.data);response_wrap.slideDown();spinner.hide();if(response.success===!0){button.slideUp();button.closest('.single-rank').addClass('user-has-earned');button.closest('.user-has-not-earned[class*="post"]').removeClass('user-has-not-earned').addClass('user-has-earned');button.closest('.gamipress-rank.user-has-not-earned').removeClass('user-has-not-earned').addClass('user-has-earned')}else{button.prop('disabled',!1)}}})})})(jQuery)