(function($){$("#search_data_to_clean").click(function(e){e.preventDefault();var $this=$(this);$this.prop('disabled',!0);$this.parent().append('<span id="clean-data-response"><span class="spinner is-active" style="float: none;"></span></span>');$.post(ajaxurl,{action:'gamipress_search_data_to_clean'},function(response){if(response.success===!1){$('#clean-data-response').css({color:'#a00'})}
$('#clean-data-response').html(response.data.message);if(response.success===!0&&response.data.found_results>0){$this.hide();$("#clean_data").show()}
$this.prop('disabled',!1)})});$("#clean_data").hide();$("#clean_data").click(function(e){e.preventDefault();var $this=$(this);$this.prop('disabled',!0);$('#clean-data-response').html('<span class="spinner is-active" style="float: none;"></span>');$.post(ajaxurl,{action:'gamipress_clean_data_tool'},function(response){if(response.success===!1){$('#clean-data-response').css({color:'#a00'})}
$('#clean-data-response').html(response.data)})});var reset_data_dialog=$("#reset-data-dialog");reset_data_dialog.dialog({dialogClass:'wp-dialog',modal:!0,autoOpen:!1,closeOnEscape:!0,draggable:!1,width:500,buttons:[{text:"Yes, delete it permanently",class:"button-primary reset-data-button",click:function(){$('.reset-data-button').prop('disabled',!0);$('.reset-data-button').parent().parent().prepend('<span id="reset-data-response"><span class="spinner is-active" style="float: none;"></span></span>');var items=[];$('.cmb2-id-data-to-reset input:checked').each(function(){items.push($(this).val())});$.post(ajaxurl,{action:'gamipress_reset_data_tool',items:items},function(response){if(response.success===!1){$('#reset-data-response').css({color:'#a00'})}
$('#reset-data-response').html(response.data);if(response.success===!0){setTimeout(function(){$('.cmb2-id-data-to-reset input:checked').each(function(){$(this).prop('checked',!1)});$('#reset-data-response').remove();reset_data_dialog.dialog("close")},2000)}
$('.reset-data-button').prop('disabled',!1)})}},{text:"Cancel",class:"cancel-reset-data-button",click:function(){$(this).dialog("close")}}]});$("#reset_data").click(function(e){e.preventDefault();$('#reset-data-warning').remove();var checked_options=$('.cmb2-id-data-to-reset input:checked');if(checked_options.length){var reminder_html='';checked_options.each(function(){reminder_html+='<li>'+$(this).next().text()+'</li>'});$('#reset-data-reminder').html('<ul>'+reminder_html+'</ul>');reset_data_dialog.dialog('open');$('.ui-dialog :button').blur()}else{$(this).parent().prepend('<p id="reset-data-warning" class="cmb2-metabox-description" style="color: #a00;">You need to choose at least one option.</p>')}});$('.cmb2-id-data-to-reset').on('change','input',function(){$('#reset-data-warning').remove();var checked_option=$(this).val();if(checked_option==='achievement_types'){$('.cmb2-id-data-to-reset input[value="achievements"], .cmb2-id-data-to-reset input[value="steps"]').prop('checked',$(this).prop('checked'))}else if(checked_option==='achievements'){$('.cmb2-id-data-to-reset input[value="steps"]').prop('checked',$(this).prop('checked'))}else if(checked_option==='points_types'){$('.cmb2-id-data-to-reset input[value="points_awards"]').prop('checked',$(this).prop('checked'))}})})(jQuery)